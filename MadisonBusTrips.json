{"paragraphs":[{"text":"%md ## Madison Bus Trip Analysis","dateUpdated":"Mar 29, 2016 7:05:33 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459106426320_1100598611","id":"20160327-142026_1638092211","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Madison Bus Trip Analysis</h2>\n"},"dateCreated":"Mar 27, 2016 2:20:26 PM","dateStarted":"Mar 29, 2016 7:05:33 PM","dateFinished":"Mar 29, 2016 7:05:34 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:22"},{"title":"Load data into table","text":"// Zeppelin creates and injects sc (SparkContext) and sqlContext (HiveContext or SqlContext)\n// So you don't need create them manually\nimport org.apache.spark.sql.functions._\n\n// load bus trip data\nval busTrip = sc.textFile(\"/home/pitt/Documents/trips.txt\")\nval busTripHeader = busTrip.first() \nval busTripData = busTrip.filter( line => line !=busTripHeader)\n\ncase class Trip(routeId: Integer, routeShortName: String, serviceId: String, tripId: Integer, tripHeadsign: String, directionId: Integer, directionName: String, blockId: Integer, shapeId: Integer, shapeCode: String, tripType: String, tripSort: Integer, wheelchairAccessible: Integer, bikesAllowed: Integer )\n\n// example of data row 6838,01,70_WKD,723344,CAPITOL SQUARE,0,CapSq,170361,42380,1E,,35820,1,1\n\nval trip = busTripData.map(s => s.split(\",\"))\n  .map(s => Trip(s(0).toInt, s(1), s(2), s(3).toInt, s(4), s(5).toInt,s(6),s(7).toInt, s(8).toInt, s(9), s(10) ,s(11).toInt, s(12).toInt, s(13).toInt)).toDF()\n\ntrip.registerTempTable(\"tripTable\")","dateUpdated":"Mar 29, 2016 7:07:26 PM","config":{"colWidth":12,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459103412392_-364985973","id":"20160327-133012_710656733","result":{"code":"SUCCESS","type":"TEXT","msg":"import org.apache.spark.sql.functions._\nbusTrip: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at textFile at <console>:34\nbusTripHeader: String = route_id,route_short_name,service_id,trip_id,trip_headsign,direction_id,direction_name,block_id,shape_id,shape_code,trip_type,trip_sort,wheelchair_accessible,bikes_allowed\nbusTripData: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[2] at filter at <console>:36\ndefined class Trip\ntrip: org.apache.spark.sql.DataFrame = [routeId: int, routeShortName: string, serviceId: string, tripId: int, tripHeadsign: string, directionId: int, directionName: string, blockId: int, shapeId: int, shapeCode: string, tripType: string, tripSort: int, wheelchairAccessible: int, bikesAllowed: int]\n"},"dateCreated":"Mar 27, 2016 1:30:12 PM","dateStarted":"Mar 29, 2016 7:07:26 PM","dateFinished":"Mar 29, 2016 7:08:43 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23"},{"text":"%sql \nselect routeShortName, count(tripId) value\nfrom tripTable \nwhere wheelchairAccessible = 1 \ngroup by routeShortName \norder by routeShortName","dateUpdated":"Mar 29, 2016 7:09:04 PM","config":{"colWidth":10,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"routeShortName","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459103412393_-365370722","id":"20160327-133012_1462604362","result":{"code":"SUCCESS","type":"TABLE","msg":"routeShortName\tvalue\n01\t48\n02\t790\n03\t277\n04\t471\n05\t457\n06\t605\n07\t416\n08\t199\n10\t494\n11\t55\n12\t46\n13\t398\n14\t197\n15\t253\n16\t422\n17\t221\n18\t682\n19\t169\n20\t642\n21\t255\n22\t282\n25\t8\n26\t299\n27\t54\n28\t132\n29\t16\n30\t656\n31\t144\n32\t141\n33\t59\n34\t44\n35\t63\n36\t230\n37\t101\n38\t143\n39\t48\n40\t233\n44\t55\n47\t85\n48\t24\n49\t40\n50\t235\n51\t161\n52\t156\n55\t68\n56\t79\n57\t87\n58\t80\n59\t223\n63\t209\n67\t290\n68\t204\n70\t109\n71\t75\n72\t83\n73\t195\n75\t68\n78\t99\n80\t1102\n81\t256\n82\t260\n84\t20\n","comment":"","msgTable":[[{"key":"value","value":"01"},{"key":"value","value":"48"}],[{"value":"02"},{"value":"790"}],[{"value":"03"},{"value":"277"}],[{"value":"04"},{"value":"471"}],[{"value":"05"},{"value":"457"}],[{"value":"06"},{"value":"605"}],[{"value":"07"},{"value":"416"}],[{"value":"08"},{"value":"199"}],[{"value":"10"},{"value":"494"}],[{"value":"11"},{"value":"55"}],[{"value":"12"},{"value":"46"}],[{"value":"13"},{"value":"398"}],[{"value":"14"},{"value":"197"}],[{"value":"15"},{"value":"253"}],[{"value":"16"},{"value":"422"}],[{"value":"17"},{"value":"221"}],[{"value":"18"},{"value":"682"}],[{"value":"19"},{"value":"169"}],[{"value":"20"},{"value":"642"}],[{"value":"21"},{"value":"255"}],[{"value":"22"},{"value":"282"}],[{"value":"25"},{"value":"8"}],[{"value":"26"},{"value":"299"}],[{"value":"27"},{"value":"54"}],[{"value":"28"},{"value":"132"}],[{"value":"29"},{"value":"16"}],[{"value":"30"},{"value":"656"}],[{"value":"31"},{"value":"144"}],[{"value":"32"},{"value":"141"}],[{"value":"33"},{"value":"59"}],[{"value":"34"},{"value":"44"}],[{"value":"35"},{"value":"63"}],[{"value":"36"},{"value":"230"}],[{"value":"37"},{"value":"101"}],[{"value":"38"},{"value":"143"}],[{"value":"39"},{"value":"48"}],[{"value":"40"},{"value":"233"}],[{"value":"44"},{"value":"55"}],[{"value":"47"},{"value":"85"}],[{"value":"48"},{"value":"24"}],[{"value":"49"},{"value":"40"}],[{"value":"50"},{"value":"235"}],[{"value":"51"},{"value":"161"}],[{"value":"52"},{"value":"156"}],[{"value":"55"},{"value":"68"}],[{"value":"56"},{"value":"79"}],[{"value":"57"},{"value":"87"}],[{"value":"58"},{"value":"80"}],[{"value":"59"},{"value":"223"}],[{"value":"63"},{"value":"209"}],[{"value":"67"},{"value":"290"}],[{"value":"68"},{"value":"204"}],[{"value":"70"},{"value":"109"}],[{"value":"71"},{"value":"75"}],[{"value":"72"},{"value":"83"}],[{"value":"73"},{"value":"195"}],[{"value":"75"},{"value":"68"}],[{"value":"78"},{"value":"99"}],[{"value":"80"},{"value":"1102"}],[{"value":"81"},{"value":"256"}],[{"value":"82"},{"value":"260"}],[{"value":"84"},{"value":"20"}]],"columnNames":[{"name":"routeShortName","index":0,"aggr":"sum"},{"name":"value","index":1,"aggr":"sum"}],"rows":[["01","48"],["02","790"],["03","277"],["04","471"],["05","457"],["06","605"],["07","416"],["08","199"],["10","494"],["11","55"],["12","46"],["13","398"],["14","197"],["15","253"],["16","422"],["17","221"],["18","682"],["19","169"],["20","642"],["21","255"],["22","282"],["25","8"],["26","299"],["27","54"],["28","132"],["29","16"],["30","656"],["31","144"],["32","141"],["33","59"],["34","44"],["35","63"],["36","230"],["37","101"],["38","143"],["39","48"],["40","233"],["44","55"],["47","85"],["48","24"],["49","40"],["50","235"],["51","161"],["52","156"],["55","68"],["56","79"],["57","87"],["58","80"],["59","223"],["63","209"],["67","290"],["68","204"],["70","109"],["71","75"],["72","83"],["73","195"],["75","68"],["78","99"],["80","1102"],["81","256"],["82","260"],["84","20"]]},"dateCreated":"Mar 27, 2016 1:30:12 PM","dateStarted":"Mar 29, 2016 7:09:05 PM","dateFinished":"Mar 29, 2016 7:09:11 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24"},{"text":"%sql \nselect blockId, count(tripId) value \nfrom tripTable \nwhere routeShortName < ${Route Name} \ngroup by blockId \norder by value desc\nlimit 5","dateUpdated":"Mar 29, 2016 7:10:18 PM","config":{"colWidth":6,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"blockId","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{"maxAge":"35","Route Name":"77"},"forms":{"Route Name":{"name":"Route Name","defaultValue":"","hidden":false}}},"jobName":"paragraph_1459103412394_-364216475","id":"20160327-133012_55674825","result":{"code":"SUCCESS","type":"TABLE","msg":"blockId\tvalue\n170863\t44\n170867\t44\n172826\t44\n170541\t35\n172480\t35\n","comment":"","msgTable":[[{"key":"value","value":"170863"},{"key":"value","value":"44"}],[{"value":"170867"},{"value":"44"}],[{"value":"172826"},{"value":"44"}],[{"value":"170541"},{"value":"35"}],[{"value":"172480"},{"value":"35"}]],"columnNames":[{"name":"blockId","index":0,"aggr":"sum"},{"name":"value","index":1,"aggr":"sum"}],"rows":[["170863","44"],["170867","44"],["172826","44"],["170541","35"],["172480","35"]]},"dateCreated":"Mar 27, 2016 1:30:12 PM","dateStarted":"Mar 29, 2016 7:10:18 PM","dateFinished":"Mar 29, 2016 7:10:20 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:25"},{"text":"//Trip Distance\n\nval tripDist = sc.textFile(\"/home/pitt/Documents/stop_times.txt\")\nval tripDistHeader = tripDist.first() \nval tripDistData = tripDist.filter( line => line !=tripDistHeader)\n\ncase class stopDist(tripId: Integer, stopSequence: Integer, stopId: Integer, pickupType: Integer, dropoffType: Integer, arrivalTime: String ,departureTime: String, timePoint: String, distanceTraveled: Float )\n\n// example of data row 723344,18,1787,1,0,10:13:00,10:13:00,1,2.8175\n\nval busStopDist = tripDistData.map(s => s.split(\",\"))\n  .map(s => stopDist(s(0).toInt, s(1).toInt, s(2).toInt, s(3).toInt, s(4).toInt, s(5), s(6), s(7), s(8).toFloat)).toDF()\n\nbusStopDist.registerTempTable(\"tripDistTable\")\n\n","dateUpdated":"Mar 29, 2016 7:10:54 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459103412397_-366909718","id":"20160327-133012_1818413021","result":{"code":"SUCCESS","type":"TEXT","msg":"tripDist: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[34] at textFile at <console>:34\ntripDistHeader: String = trip_id,stop_sequence,stop_id,pickup_type,drop_off_type,arrival_time,departure_time,timepoint,shape_dist_traveled\ntripDistData: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[35] at filter at <console>:36\ndefined class stopDist\nbusStopDist: org.apache.spark.sql.DataFrame = [tripId: int, stopSequence: int, stopId: int, pickupType: int, dropoffType: int, arrivalTime: string, departureTime: string, timePoint: string, distanceTraveled: float]\n"},"dateCreated":"Mar 27, 2016 1:30:12 PM","dateStarted":"Mar 29, 2016 7:10:54 PM","dateFinished":"Mar 29, 2016 7:10:58 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:26"},{"text":"%sql\n-- example joining two datasets together\nselect tripTable.routeShortName, max(stopSequence) as maxStops, max(distanceTraveled) as maxDist, max(distanceTraveled)/max(stopSequence) as avgDistPerStop\nfrom tripTable\njoin tripDistTable on (tripTable.tripId = tripDistTable.tripId)\ngroup by tripTable.routeShortName order by maxDist desc limit 1\n","dateUpdated":"Mar 29, 2016 7:12:04 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459108524279_-1547455690","id":"20160327-145524_151354179","result":{"code":"SUCCESS","type":"TABLE","msg":"routeShortName\tmaxStops\tmaxDist\tavgDistPerStop\n56\t81\t18.4178\t0.22738025806568288\n","comment":"","msgTable":[[{"key":"maxStops","value":"56"},{"key":"maxStops","value":"81"},{"key":"maxStops","value":"18.4178"},{"key":"maxStops","value":"0.22738025806568288"}]],"columnNames":[{"name":"routeShortName","index":0,"aggr":"sum"},{"name":"maxStops","index":1,"aggr":"sum"},{"name":"maxDist","index":2,"aggr":"sum"},{"name":"avgDistPerStop","index":3,"aggr":"sum"}],"rows":[["56","81","18.4178","0.22738025806568288"]]},"dateCreated":"Mar 27, 2016 2:55:24 PM","dateStarted":"Mar 29, 2016 7:12:04 PM","dateFinished":"Mar 29, 2016 7:12:20 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27"},{"text":"%md ### Data Citation\n\n[City of Madison Open Data Portal](http://www.cityofmadison.com/metro/Apps/developers.cfm)","dateUpdated":"Mar 29, 2016 7:13:09 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459105935728_1777279458","id":"20160327-141215_1424085873","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Data Citation</h3>\n<p><a href=\"http://www.cityofmadison.com/metro/Apps/developers.cfm\">City of Madison Open Data Portal</a></p>\n"},"dateCreated":"Mar 27, 2016 2:12:15 PM","dateStarted":"Mar 29, 2016 7:13:09 PM","dateFinished":"Mar 29, 2016 7:13:09 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:28"},{"dateUpdated":"Mar 27, 2016 3:28:29 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1459108957967_-319092014","id":"20160327-150237_119497796","result":{"code":"SUCCESS","type":"TEXT"},"dateCreated":"Mar 27, 2016 3:02:37 PM","dateStarted":"Mar 27, 2016 3:28:36 PM","dateFinished":"Mar 27, 2016 3:28:38 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:29"}],"name":"Madison Bus Trips","id":"2BEGDP4AZ","angularObjects":{"2BHGZM6K4":[],"2BDVK5EPF":[],"2BFZ1YP4M":[],"2BHKFQC3B":[],"2BDVT3YXY":[],"2BEVXMX2P":[],"2BGVPY4D6":[],"2BHH4MNUB":[]},"config":{"looknfeel":"default"},"info":{}}